{{include file="public/header" /}}

<!-- content top hook -->
{{if isset($shopxo_is_develop) and $shopxo_is_develop eq true and (!isset($is_footer) or $is_footer eq 1)}}
    <div class="plugins-tag">
        <span>{{$hook_name_content_top}}</span>
    </div>
{{/if}}
{{php}}
    $hook_data = Hook::listen($hook_name_content_top, ['hook_name'=>$hook_name_content_top, 'is_backend'=>true]);
    if(!empty($hook_data) && is_array($hook_data))
    {
        foreach($hook_data as $hook)
        {
            if(is_string($hook) || is_int($hook))
            {
                echo htmlspecialchars_decode($hook);
            }
        }
    }
{{/php}}

<!-- right content start  -->
<div class="content-right">
    <div class="content form-table-content">
        <!-- content inside top hook -->
        {{if isset($shopxo_is_develop) and $shopxo_is_develop eq true and (!isset($is_footer) or $is_footer eq 1)}}
            <div class="plugins-tag">
                <span>{{$hook_name_content_inside_top}}</span>
            </div>
        {{/if}}
        {{php}}
            $hook_data = Hook::listen($hook_name_content_inside_top, ['hook_name'=>$hook_name_content_inside_top, 'is_backend'=>true]);
            if(!empty($hook_data) && is_array($hook_data))
            {
                foreach($hook_data as $hook)
                {
                    if(is_string($hook) || is_int($hook))
                    {
                        echo htmlspecialchars_decode($hook);
                    }
                }
            }
        {{/php}}

        <!-- form -->
        {{if !empty($form_table) and !empty($form_table['base']) and !empty($form_table['form']) and is_array($form_table['base']) and is_array($form_table['form'])}}
            <form class="form-validation-search" method="post" action="{{if isset($form_table['base']['is_search']) and $form_table['base']['is_search'] eq 1 and !empty($form_table['base']['search_url'])}}{{$form_table.base.search_url}}{{/if}}" request-type="jump" request-value="{{if isset($form_table['base']['is_search']) and $form_table['base']['is_search'] eq 1 and !empty($form_table['base']['search_url'])}}{{$form_table.base.search_url}}{{/if}}">
                <!-- top operate start -->
                <div class="am-g form-table-operate-top">
                    {{block name="form_operate_top"}}
                        <!-- 公共操作 -->
                        <a href="{{:MyUrl('admin/goods/index')}}" class="am-btn am-btn-warning am-radius am-btn-sm am-icon-filter"> 重置</a>
                        <button type="submit" class="am-btn am-btn-primary am-radius am-btn-xs btn-loading-example am-icon-search" data-am-loading="{loadingText:' 搜索中...'}"> 搜索</button>

                        <!-- 钩子 -->
                        {{if isset($shopxo_is_develop) and $shopxo_is_develop eq true and (!isset($is_footer) or $is_footer eq 1)}}
                            <div class="plugins-tag">
                                <span>plugins_view_admin_goods_top_operate</span>
                            </div>
                        {{/if}}
                        {{php}}
                            $hook_name = 'plugins_view_admin_goods_top_operate';
                            $hook_data = Hook::listen($hook_name, ['hook_name'=>$hook_name, 'is_backend'=>true]);
                            if(!empty($hook_data) && is_array($hook_data))
                            {
                                foreach($hook_data as $hook)
                                {
                                    if(is_string($hook) || is_int($hook))
                                    {
                                        echo htmlspecialchars_decode($hook);
                                    }
                                }
                            }
                        {{/php}}
                    {{/block}}
                </div>
                <!-- top operate end -->

                <!-- list start -->
                <div class="am-scrollable-horizontal am-table-scrollable-horizontal am-margin-top-sm">
                    <table class="am-table am-table-striped am-table-hover am-table-bordered am-text-nowrap">
                        <thead>
                            <tr>
                                {{foreach $form_table['form'] as $t}}
                                    <!-- 1. 上下居中 -->
                                    <!-- 2. 格子大小 -->
                                    <!-- 3. 内容位置居（左|中|右） -->
                                    <!-- 4. 格子是否固定（left|right 左|右） -->
                                    <th class="
                                        {{if !isset($t['is_middle']) or $t['is_middle'] eq 1}}am-text-middle {{/if}}
                                        {{if !empty($t['grid_size'])}}am-grid-{{$t.grid_size}} {{/if}}
                                        {{if !empty($t['align'])}}am-text-{{$t.align}} {{/if}}
                                        {{if !empty($t['fixed'])}}am-grid-fixed-{{$t.fixed}} {{/if}}
                                        {{if !empty($t['view_type']) and $t['view_type'] eq 'operate'}}am-operate-grid {{/if}}
                                    "
                                    style="
                                        {{if !empty($t['width'])}}
                                            min-width: {{$t.width}}px;
                                        {{/if}}
                                    "
                                    >
                                        {{switch $t.view_type}}
                                            {{case checkbox}}
                                                <button type="button" class="am-btn am-btn-secondary am-radius am-btn-xs form-table-operate-checkbox-submit" data-value="{{if isset($t['is_checked']) and $t['is_checked'] eq 1}}1{{else /}}0{{/if}}" data-checked-text="{{$t.checked_text}}" data-not-checked-text="{{$t.not_checked_text}}" {{if empty($data_list)}}disabled{{/if}}>{{if isset($t['is_checked']) and $t['is_checked'] eq 1}}{{$t.checked_text}}{{else /}}{{$t.not_checked_text}}{{/if}}</button>
                                            {{/case}}
                                            {{default /}}
                                                {{if isset($t['label'])}}{{$t.label}}{{/if}}
                                        {{/switch}}
                                    </th>
                                {{/foreach}}
                            </tr>

                            <!-- search -->
                            {{if isset($form_table['base']['is_search']) and $form_table['base']['is_search'] eq 1}}
                                <tr class="form-table-search">
                                    {{foreach $form_table['form'] as $k=>$t}}
                                        <td class="
                                            {{if !isset($t['is_middle']) or $t['is_middle'] eq 1}}am-text-middle {{/if}}
                                            {{if !empty($t['grid_size'])}}am-grid-{{$t.grid_size}} {{/if}}
                                            {{if !empty($t['align'])}}am-text-{{$t.align}} {{/if}}
                                            {{if !empty($t['fixed'])}}am-grid-fixed-{{$t.fixed}} {{/if}}
                                            {{if !empty($t['view_type']) and $t['view_type'] eq 'operate'}}am-operate-grid {{/if}}
                                        "
                                        style="
                                            {{if !empty($t['width'])}}
                                                min-width: {{$t.width}}px;
                                            {{/if}}
                                        "
                                        >
                                            {{if !empty($t['search_config']) and !empty($t['search_config']['form_type']) and !empty($t['search_config']['form_name'])}}
                                                {{switch $t.search_config.form_type}}
                                                    {{case input}}
                                                        <!-- 输入 -->
                                                        <input type="text" class="am-form-field am-radius" autocomplete="off" name="{{$t.form_key}}" value="{{if !empty($form_params) and isset($form_params[$t['form_key']])}}{{$form_params[$t['form_key']]}}{{/if}}" placeholder="{{if isset($t['search_config']['placeholder'])}}{{$t.search_config.placeholder}}{{/if}}" />
                                                    {{/case}}
                                                    {{case select}}
                                                        <!-- 选择 -->
                                                        <select name="{{$t.form_key}}" class="chosen-select am-text-left" data-placeholder="{{if isset($t['search_config']['placeholder'])}}{{$t.search_config.placeholder}}{{/if}}" {{if isset($t['search_config']['is_multiple']) and $t['search_config']['is_multiple'] eq 1}}multiple{{/if}}>
                                                            {{if isset($t['search_config']['is_seat_select']) and $t['search_config']['is_seat_select'] eq 1 and (!isset($t['search_config']['is_multiple']) or $t['search_config']['is_multiple'] neq 1)}}
                                                                <option value="{{if isset($t['search_config']['seat_select_value'])}}{{$t.search_config.seat_select_value}}{{/if}}">
                                                                    {{if empty($t['search_config']['seat_select_text'])}}{{if empty($t['search_config']['placeholder'])}}请选择{{if !empty($t['label'])}}{{$t.label}}{{/if}}{{else /}}{{$t.search_config.placeholder}}{{/if}}{{else /}}{{$t.search_config.seat_select_text}}{{/if}}
                                                                </option>
                                                            {{/if}}
                                                            {{if !empty($t['search_config']['data']) and is_array($t['search_config']['data'])}}
                                                                {{foreach $t['search_config']['data'] as $v}}
                                                                    <option value="{{if isset($t['search_config']['data_key']) and isset($v[$t['search_config']['data_key']])}}{{$v[$t['search_config']['data_key']]}}{{/if}}" {{if !empty($form_params) and isset($form_params[$t['form_key']]) and is_array($form_params[$t['form_key']]) and isset($t['search_config']['data_key']) and  in_array($v[$t['search_config']['data_key']], $form_params[$t['form_key']])}}selected{{/if}}>
                                                                        {{if isset($t['search_config']['data_name']) and isset($v[$t['search_config']['data_name']])}}
                                                                            {{$v[$t['search_config']['data_name']]}}
                                                                        {{/if}}
                                                                    </option>
                                                                {{/foreach}}
                                                            {{/if}}
                                                        </select>
                                                    {{/case}}
                                                    {{case section}}
                                                        <!-- 区间 -->
                                                        <div class="form-table-search-section">
                                                            <input type="number" class="am-form-field am-radius am-inline-block" autocomplete="off" name="{{$t.form_key}}_min" value="{{if !empty($form_params) and isset($form_params[$t['form_key'].'_min'])}}{{$form_params[$t['form_key'].'_min']}}{{/if}}" {{if isset($t['search_config']['is_point']) and $t['search_config']['is_point'] eq 1}}step="0.01"{{/if}} min="0" placeholder="{{if isset($t['search_config']['placeholder_min'])}}{{$t.search_config.placeholder_min}}{{/if}}" />
                                                            <span>-</span>
                                                            <input type="number" class="am-form-field am-radius am-inline-block" autocomplete="off" name="{{$t.form_key}}_max" value="{{if !empty($form_params) and isset($form_params[$t['form_key'].'_max'])}}{{$form_params[$t['form_key'].'_max']}}{{/if}}" {{if isset($t['search_config']['is_point']) and $t['search_config']['is_point'] eq 1}}step="0.01"{{/if}} min="0" placeholder="{{if isset($t['search_config']['placeholder_max'])}}{{$t.search_config.placeholder_max}}{{/if}}" />
                                                        </div>
                                                    {{/case}}
                                                    {{case datetime}}
                                                        <div class="form-table-search-section form-table-search-time">
                                                            <input type="text" autocomplete="off" class="am-form-field am-input-sm am-radius am-inline-block Wdate" id="form-table-search-time-start-{{$t.form_key}}" name="{{$t.form_key}}_start" value="{{if !empty($form_params) and isset($form_params[$t['form_key'].'_start'])}}{{$form_params[$t['form_key'].'_start']}}{{/if}}" placeholder="{{if isset($t['search_config']['placeholder_start'])}}{{$t.search_config.placeholder_start}}{{/if}}" value="" onclick="WdatePicker({firstDayOfWeek:1,dateFmt:'yyyy-MM-dd H:mm:ss',maxDate:'#F{$dp.$D(\'form-table-search-time-end-{{$t.form_key}}\');}'})" autocomplete="off" />
                                                            <span>-</span>
                                                            <input type="text" autocomplete="off" class="am-form-field am-input-sm am-radius am-inline-block Wdate" id="form-table-search-time-end-{{$t.form_key}}" name="{{$t.form_key}}_end" value="{{if !empty($form_params) and isset($form_params[$t['form_key'].'_end'])}}{{$form_params[$t['form_key'].'_end']}}{{/if}}" placeholder="{{if isset($t['search_config']['placeholder_end'])}}{{$t.search_config.placeholder_end}}{{/if}}" value="" onclick="WdatePicker({firstDayOfWeek:1,dateFmt:'yyyy-MM-dd H:mm:ss',minDate:'#F{$dp.$D(\'form-table-search-time-start-{{$t.form_key}}\');}'})" autocomplete="off" />
                                                        </div>
                                                    {{/case}}
                                                    {{case date}}
                                                        <div class="form-table-search-section form-table-search-time">
                                                            <input type="text" autocomplete="off" class="am-form-field am-input-sm am-radius am-inline-block Wdate" id="form-table-search-time-start-{{$t.form_key}}" name="{{$t.form_key}}_start" value="{{if !empty($form_params) and isset($form_params[$t['form_key'].'_start'])}}{{$form_params[$t['form_key'].'_start']}}{{/if}}" placeholder="{{if isset($t['search_config']['placeholder_start'])}}{{$t.search_config.placeholder_start}}{{/if}}" value="" onclick="WdatePicker({firstDayOfWeek:1,dateFmt:'yyyy-MM-dd',maxDate:'#F{$dp.$D(\'form-table-search-time-end-{{$t.form_key}}\',{d:-1});}'})" autocomplete="off" />
                                                            <span>-</span>
                                                            <input type="text" autocomplete="off" class="am-form-field am-input-sm am-radius am-inline-block Wdate" id="form-table-search-time-end-{{$t.form_key}}" name="{{$t.form_key}}_end" value="{{if !empty($form_params) and isset($form_params[$t['form_key'].'_end'])}}{{$form_params[$t['form_key'].'_end']}}{{/if}}" placeholder="{{if isset($t['search_config']['placeholder_end'])}}{{$t.search_config.placeholder_end}}{{/if}}" value="" onclick="WdatePicker({firstDayOfWeek:1,dateFmt:'yyyy-MM-dd',minDate:'#F{$dp.$D(\'form-table-search-time-start-{{$t.form_key}}\',{d:+1});}'})" autocomplete="off" />
                                                        </div>
                                                    {{/case}}
                                                    {{case module}}
                                                        <!-- 从模块加载自定义模块数据 -->
                                                        {{if !empty($t['search_config']['template'])}}
                                                            {{if isset($t['search_config']['data'])}}
                                                                {{:ModuleInclude($t['search_config']['template'], ['data'=>$t['search_config']['data'], 'form_name_key'=>$t['form_key'], 'params'=>isset($form_params) ? $form_params : []])}}
                                                            {{else /}}
                                                                {{:ModuleInclude($t['search_config']['template'], ['data'=>[], 'form_name_key'=>$t['form_key'], 'params'=>isset($form_params) ? $form_params : []])}}
                                                            {{/if}}
                                                        {{/if}}
                                                    {{/case}}
                                                {{/switch}}
                                            {{/if}}
                                        </td>
                                    {{/foreach}}
                                </tr>
                            {{/if}}
                        </thead>
                        <tbody>
                            {{if !empty($data_list) and !empty($form_table['base']['key_field'])}}
                                <!-- 处理数据数量小于默认数量 -->
                                {{for start="0" end="(count($data_list) < $page_size ? count($data_list) : $page_size)"}}
                                    <!-- 1. tr 主键id名称 -->
                                    <!-- 2. 是否黄色选中class -->
                                    <tr
                                        {{if isset($data_list[$i][$form_table['base']['key_field']])}}
                                            id="data-list-{{$data_list[$i][$form_table['base']['key_field']]}}"
                                        {{/if}}
                                        {{if !empty($form_table['base']['status_field']) and isset($data_list[$i][$form_table['base']['status_field']]) and $data_list[$i][$form_table['base']['status_field']] eq 0}}
                                            class="am-active"
                                        {{/if}}
                                    >
                                        {{foreach $form_table['form'] as $t}}
                                            <!-- 1. 上下居中 -->
                                            <!-- 2. 格子大小 -->
                                            <!-- 3. 内容位置居（左|中|右） -->
                                            <!-- 4. 格子是否固定（left|right 左|右） -->
                                            <!-- 5. 是否操作列 -->
                                            <td class="am-nowrap-initial
                                                {{if !isset($t['is_middle']) or $t['is_middle'] eq 1}}am-text-middle {{/if}}
                                                {{if !empty($t['grid_size'])}}am-grid-{{$t.grid_size}} {{/if}}
                                                {{if !empty($t['align'])}}am-text-{{$t.align}} {{/if}}
                                                {{if !empty($t['fixed'])}}am-grid-fixed-{{$t.fixed}} {{/if}}
                                                {{if !empty($t['view_type']) and $t['view_type'] eq 'operate'}}am-operate-grid {{/if}}
                                            "
                                            style="
                                                {{if !empty($t['width'])}}
                                                    min-width: {{$t.width}}px;
                                                {{/if}}
                                            "
                                            >
                                                {{if isset($data_list[$i]) and !empty($t['view_type']) and !empty($t['view_key'])}}
                                                    <!-- 数据匹配 -->
                                                    {{switch $t.view_type}}
                                                        {{case field}}
                                                            <!-- 如果字段为数组则处理多个字段拼接数据 -->
                                                            {{if is_array($t['view_key'])}}
                                                                {{foreach $t['view_key'] as $fk=>$fv}}
                                                                    {{if isset($data_list[$i][$fv])}}
                                                                        {{$data_list[$i][$fv]}}
                                                                        <!-- 多个字段拼接数据的的拼接字符 -->
                                                                        {{if isset($t['view_key_join']) and $fk lt count($t['view_key'])-1}}
                                                                            {{$t.view_key_join|raw}}
                                                                        {{/if}}
                                                                    {{/if}}
                                                                {{/foreach}}
                                                            {{else /}}
                                                                <!-- 非数组则直接取值 -->
                                                                {{if isset($data_list[$i][$t['view_key']])}}
                                                                    {{$data_list[$i][$t['view_key']]|raw}}
                                                                {{/if}}
                                                            {{/if}}
                                                        {{/case}}
                                                        {{case module}}
                                                            <!-- 从模块加载自定义模块数据 -->
                                                            {{:ModuleInclude($t['view_key'], $data_list[$i], isset($params) ? $params : [])}}
                                                        {{/case}}
                                                        {{case status}}
                                                            <!-- 数据状态操作按钮组件 -->
                                                            {{if !empty($t['key_field']) and !empty($t['post_url'])}}
                                                                <a href="javascript:;"
                                                                    class="am-icon-btn am-icon-check submit-state {{if $data_list[$i][$t['view_key']] eq 1}}am-success{{else /}}am-default{{/if}}"
                                                                    data-url="{{$t.post_url}}"
                                                                    data-id="{{if isset($data_list[$i][$t['key_field']])}}{{$data_list[$i][$t['key_field']]}}{{/if}}"
                                                                    data-state="{{$data_list[$i][$t['view_key']]}}"
                                                                    data-is-update-status="{{if isset($t['is_form_su'])}}{{$t.is_form_su}}{{else /}}0{{/if}}"
                                                                ></a>
                                                            {{/if}}
                                                        {{/case}}
                                                        {{case operate}}
                                                            <!-- 是否操作列 -->
                                                            <!-- 模块数据 -->
                                                            {{:ModuleInclude($t['view_key'], $data_list[$i])}}

                                                            <!-- 列表操作钩子 -->
                                                            {{if isset($shopxo_is_develop) and $shopxo_is_develop eq true and (!isset($is_footer) or $is_footer eq 1)}}
                                                                <div class="plugins-tag">
                                                                    <span>{{$hook_name_form_list_operate}}</span>
                                                                </div>
                                                            {{/if}}
                                                            {{php}}
                                                                $hook_data = Hook::listen($hook_name_form_list_operate, [
                                                                    'hook_name'     => $hook_name_form_list_operate,
                                                                    'is_backend'    => true,
                                                                    'id'            => isset($data_list[$i][$form_table['base']['key_field']]) ? $data_list[$i][$form_table['base']['key_field']] : 0,
                                                                    'data'          => $data_list[$i],
                                                                ]);
                                                                if(!empty($hook_data) && is_array($hook_data))
                                                                {
                                                                    foreach($hook_data as $hook)
                                                                    {
                                                                        if(is_string($hook) || is_int($hook))
                                                                        {
                                                                            echo htmlspecialchars_decode($hook);
                                                                        }
                                                                    }
                                                                }
                                                            {{/php}}
                                                        {{/case}}
                                                        {{case checkbox}}
                                                            {{if isset($data_list[$i][$form_table['base']['key_field']])}}
                                                                <div class="form-table-operate-checkbox">
                                                                    <label class="am-checkbox am-secondary am-checkbox-inline">
                                                                        <input type="checkbox" name="{{$t.view_key}}" value="{{$data_list[$i][$form_table['base']['key_field']]}}" {{if !empty($form_params) and isset($form_params[$t['view_key']]) and in_array($data_list[$i][$form_table['base']['key_field']], $form_params[$t['view_key']])}}checked{{/if}} data-am-ucheck />
                                                                    </label>
                                                                </div>
                                                            {{/if}}
                                                        {{/case}}
                                                        {{case radio}}
                                                            {{if isset($data_list[$i][$form_table['base']['key_field']])}}
                                                                <div class="form-table-operate-radio">
                                                                    <label class="am-radio am-secondary am-radio-inline">
                                                                        <input type="radio" name="{{$t.view_key}}" value="{{$data_list[$i][$form_table['base']['key_field']]}}" {{if !empty($form_params) and isset($form_params[$t['view_key']]) and $form_params[$t['view_key']] eq $data_list[$i][$form_table['base']['key_field']]}}checked{{/if}} data-am-ucheck />
                                                                    </label>
                                                                </div>
                                                            {{/if}}
                                                        {{/case}}
                                                    {{/switch}}
                                                {{/if}}
                                            </td>
                                        {{/foreach}}
                                    </tr>
                                {{/for}}
                            {{/if}}
                        </tbody>
                    </table>
                    {{if empty($data_list)}}
                        <div class="table-no"><i class="am-icon-warning"></i> 没有相关数据</div>
                    {{/if}}
                </div>
                <!-- list end -->

                <!-- bottom operate start -->
                <div class="am-g am-margin-top-sm form-table-operate-bottom">
                    {{block name="form_operate_bottom"}}
                        {{if isset($shopxo_is_develop) and $shopxo_is_develop eq true and (!isset($is_footer) or $is_footer eq 1)}}
                            <div class="plugins-tag">
                                <span>{{$hook_name_form_bottom_operate}}</span>
                            </div>
                        {{/if}}
                        {{php}}
                            $hook_data = Hook::listen($hook_name_form_bottom_operate, ['hook_name'=>$hook_name_form_bottom_operate, 'is_backend'=>true]);
                            if(!empty($hook_data) && is_array($hook_data))
                            {
                                foreach($hook_data as $hook)
                                {
                                    if(is_string($hook) || is_int($hook))
                                    {
                                        echo htmlspecialchars_decode($hook);
                                    }
                                }
                            }
                        {{/php}}
                    {{/block}}
                </div>
                <!-- bottom operate end -->
            </form>
        {{else /}}
            <div class="table-no"><i class="am-icon-warning"></i> {{if empty($form_error)}}动态表格配置有误{{else /}}{{$form_error}}{{/if}}</div>
        {{/if}}

        <!-- page start -->
        {{block name="form_page"}}
            {{if !empty($data_list)}}
                {{$page_html|raw}}
            {{/if}}
        {{/block}}
        <!-- page end -->

        <!-- content inside top hook -->
        {{if isset($shopxo_is_develop) and $shopxo_is_develop eq true and (!isset($is_footer) or $is_footer eq 1)}}
            <div class="plugins-tag">
                <span>{{$hook_name_content_inside_bottom}}</span>
            </div>
        {{/if}}
        {{php}}
            $hook_data = Hook::listen($hook_name_content_inside_bottom, ['hook_name'=>$hook_name_content_inside_bottom, 'is_backend'=>true]);
            if(!empty($hook_data) && is_array($hook_data))
            {
                foreach($hook_data as $hook)
                {
                    if(is_string($hook) || is_int($hook))
                    {
                        echo htmlspecialchars_decode($hook);
                    }
                }
            }
        {{/php}}
    </div>
</div>
<!-- right content end  -->

<!-- content bottom hook -->
{{if isset($shopxo_is_develop) and $shopxo_is_develop eq true and (!isset($is_footer) or $is_footer eq 1)}}
    <div class="plugins-tag">
        <span>{{$hook_name_content_bottom}}</span>
    </div>
{{/if}}
{{php}}
    $hook_data = Hook::listen($hook_name_content_bottom, ['hook_name'=>$hook_name_content_bottom, 'is_backend'=>true]);
    if(!empty($hook_data) && is_array($hook_data))
    {
        foreach($hook_data as $hook)
        {
            if(is_string($hook) || is_int($hook))
            {
                echo htmlspecialchars_decode($hook);
            }
        }
    }
{{/php}}
        
<!-- footer start -->
{{include file="public/footer" /}}
<!-- footer end -->